# Система управления банковскими картами

Ниже приведена краткая инструкция по сборке и запуску приложения в режимах: локально, через Docker Compose и в режиме отладки.

## Предварительные требования
- Java 21 (JDK)
- Maven 3.9.9
- Docker и Docker Compose (для контейнерного запуска)
- Свободные порты: 8080 (HTTP), 5005 (Debug), 5432 (PostgreSQL)

## Переменные окружения
Файл `.env` в корне проекта содержит значения:
- DB_USER, DB_PASSWORD, DB_NAME, DB_URL
- AES_KEY, HMAC_KEY, JWT_SECRET

При запуске в Docker Compose значения из `.env` автоматически подхватываются. Для локального запуска убедитесь, что значения согласованы с `application.yml` и доступной БД.

## Сборка проекта
1) Установить зависимости и собрать jar:

Итоговый артефакт: `target/bankcards-0.0.1-SNAPSHOT.jar`

## Локальный запуск (без Docker)
1) Убедитесь, что PostgreSQL запущен и доступен по адресу из `DB_URL`, а схема/пользователь соответствуют `.env`.
2) Запустить приложение:
3) Приложение будет доступно на:
- HTTP: http://localhost:8080
- Swagger UI: http://localhost:8080/swagger-ui/index.html
- OpenAPI: http://localhost:8080/v3/api-docs

## Локальный запуск в отладочном режиме (JDWP)
Подключение дебаггера: localhost:5005

## Запуск через Docker Compose
1) Собрать jar (см. раздел «Сборка проекта»).
2) Запустить контейнеры: docker compose up --build -d

Сервисы:
- Приложение: http://localhost:8080
- PostgreSQL: localhost:5432 (cred из `.env`)
- Порт 5005 проброшен для удалённой отладки.

Остановить: docker compose down -v
(флаг -v удалит тома и данные, опустите его, если хотите сохранить БД)

## Миграции БД
Миграции выполняются автоматически при старте (Liquibase). При изменениях схемы обновите changelog и пересоберите приложение.

## Проверка работоспособности
- Логи приложения: `logs/application.log`
- Проверить health или любую публичную точку (см. Swagger UI).

## Частые проблемы
- Порт занят: измените порт приложения в конфигурации или освободите порт.
- Нет соединения с БД: проверьте `DB_URL`, креды и доступность контейнера/сервиса БД.
- Миграции падают: убедитесь, что в БД нет конфликтующих схем и что права пользователя достаточны.
